<%= render @rental_request %>

<div class="container">
  <div class="row">
    <div class="col">
      <h2>Request #<%= @rental_request.id %>
        <span class="text-secondary">
        (<%= @rental_request.status %>)
        </span>
      </h2>
      <% if @is_submitter %>
        <p class="text-secondary">You are viewing your own request.
          <% if @rental_request.submitted? %>
            It is submitted and other users can accept it.
          <% else
               if @rental_request.open? %>
              In order to make it available to other users, make sure to submit it.
            <% end end %>
        </p>
      <% end %>
    </div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="row mt-2 align-items-center">
        <%= render 'users/user_snippet', user: @rental_request.submitter %>
        <div class="ms-auto col-md-auto">
          <div class="btn-group gap-2">
            <% if @is_submitter %>
              <% if @rental_request.editable? %>
                <% if @rental_request.submitted? %>
                  <%= button_to reopen_rental_request_path(@rental_request),
                                class: "btn btn-outline-primary", method: :put do %>
                    <i class="bi bi-arrow-down-circle me-1"></i> Re-open
                  <% end %>
                <% else %>
                  <%= button_to submit_rental_request_path(@rental_request),
                                class: "btn btn-outline-primary", method: :put do %>
                    <i class="bi bi-arrow-up-circle me-1"></i> Submit
                  <% end %>
                <% end %>
                <%= button_to edit_rental_request_path, method: :get, class: "btn btn-outline-primary" do %>
                  <i class="bi bi-pencil me-1"></i> Edit details
                <% end %>
                <%= button_to @rental_request, method: :delete, class: "btn btn-outline-danger", form: { data: { 'turbo-confirm': 'Are you sure?' } } do %>
                  <i class="bi bi-trash me-1"></i> Discard
                <% end %>
              <% end %>
            <% else %>
              <%= link_to "Accept request", root_url, type: 'button', class: "btn btn-primary" if @rental_request.submitted?%>
            <% end %>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <h4>Description</h4>
        <p>
          <%= @rental_request.description %>
        </p>
      </div>
      <div class="row mt-3">
        <div class="col-md mb-3">
          <h4>Wants</h4>
          <ul class="list-group">
            <% @rental_request.wanted_per_requests.each do |query| %>
              <li class="list-group-item">
                <div class="d-flex align-items-center">
                  <div>
                    <%= image_tag(query.game.thumbnail_url, class: "img-thumbnail flex-shrink-0", height: 20, width: 70) %>
                    <b class="ms-md-2"><%= link_to query.game.title, query.game %></b>
                  </div>
                  <div class="ms-auto">
                    <%= render 'trash_wanted_form', rental_request: @rental_request, game: query.game unless @rental_request.submitted? %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
        <div class="col-md">
          <h4>Offers in return</h4>
          <ul class="list-group">
            <% @rental_request.offered_per_requests.each do |query| %>
              <li class="list-group-item">
                <div class="d-flex align-items-center">
                  <div>
                    <%= image_tag(query.game.thumbnail_url, class: "img-thumbnail flex-shrink-0", height: 20, width: 70) %>
                    <b class="ms-md-2"><%= link_to query.game.title, query.game %></b>
                  </div>
                  <div class="ms-auto">
                    <%= render 'trash_offered_form', rental_request: @rental_request, game: query.game unless @rental_request.submitted? %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

